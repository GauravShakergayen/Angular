<apex:page standardController="Project__c" extensions="EST_EstimationPage_Extenstion" showHeader="false" sidebar="false" doctype="html-5.0" standardStylesheets="false" showChat="false" applyBodyTag="false" applyHtmlTag="false">
<html lang="en" ng-app="dEstimator">
    <head>
        <apex:stylesheet value="{!URLFOR($Resource.ESTResources,'/css/bootstrap.min.css')}" />
        <apex:stylesheet value="{!URLFOR($Resource.ESTResources,'/css/font-awesome.min.css')}" />
        <apex:stylesheet value="{!URLFOR($Resource.ESTResources,'/css/estimatorCustom.css')}" />
        <apex:stylesheet value="{!URLFOR($Resource.AgGrid_Bundle,'/ag-grid-bundle/node_modules/ag-grid-community/dist/styles/ag-grid.css')}" />
        <apex:stylesheet value="{!URLFOR($Resource.AgGrid_Bundle,'/ag-grid-bundle/node_modules/ag-grid-community/dist/styles/ag-theme-balham.css')}" />
       
        <apex:includeScript value="{!URLFOR($Resource.ESTResources,'/script/jquery.min.js')}" />
        <apex:includeScript value="{!URLFOR($Resource.ESTResources,'/script/bootstrap.min.js')}" />
        <apex:includeScript value="{!URLFOR($Resource.ESTResources,'/script/angular.min.js')}" />
        <apex:includeScript value="{!URLFOR($Resource.ESTResources,'/script/angular-animate.min.js')}" />
       
        <apex:includeScript value="{!URLFOR($Resource.AgGrid_Bundle,'/ag-grid-bundle/node_modules/ag-grid-community/dist/ag-grid-community.min.js')}" />
        <style type="text/css">
            html, body { margin: 0; padding: 0; height: 100%; }
        </style>
        </head>
    <body>
       
       <div ng-controller="dEstimatorController as estimatorCtrl" style="height: 100%">
         <div ag-grid="gridOptions" class="ag-theme-balham" style="height: 100%;"></div>
       </div>
      
       <script type="text/javascript">
                
        agGrid.initialiseAgGridWithAngular1(angular);
        var dEstimator = angular.module("dEstimator", ["agGrid","ngAnimate"]);
        
        dEstimator.controller("dEstimatorController", function($scope) {
            
            var columnDefs = [
                {headerName: "S.No.", field: "reqNo",width: 100,autoHeight: true},
                {headerName: "Requirement Detail", field: "reqDetail",width: 150,autoHeight: true},
                {headerName: "Functional Area", field: "funcArea",width: 150,autoHeight: true},
                {headerName: "User", field: "assignedUser",width: 100,autoHeight: true},
                {headerName: "Questions", field: "comm",width: 150,editable: true,cellEditor: "agLargeTextCellEditor",
                             cellEditorParams:{maxLength: 300, rows: 10, cols: 20}},
                {headerName: "Assumptions", field: "assump",width: 150,editable: true,autoHeight: true,cellEditor: "agLargeTextCellEditor",
                              cellEditorParams:{maxLength: 300,rows: 10, cols: 20}},
                {headerName: "Scope Description", field: "confScope",width: 150,editable: true,autoHeight: true,cellEditor: "agLargeTextCellEditor",
                              cellEditorParams:{maxLength: 300,rows: 10,cols: 20}},
                {headerName: "Scope Compxlexity", field: "scopeComplexity",width: 350,autoHeight: true,
                  cellRenderer: function(params) {
                  //create table tag
                  var tableElement = document.createElement("table");
                  tableElement.setAttribute('id', 'scopeComplexityTable');
                    
                    //create table headers
                    var arrHead = [];
                    arrHead = ['  ','  ', 'Units', 'Story Points'];
                    //create data for td tags
                    var arrValue = [];
                    arrValue.push(['Configuration:',params.data.confComplex, params.data.confUnits, params.data.confHours]);
                    arrValue.push(['Customization:',params.data.custComplex, params.data.custUnits, params.data.custHours]);
                    arrValue.push(['Integration:',params.data.integComplex, params.data.integUnits, params.data.integHours]);
                    arrValue.push(['UI Design:',params.data.uiComplex, params.data.uiUnits, params.data.uiHours]);
                    arrValue.push(['Data Migration:',params.data.dataComplex, params.data.dataUnits, params.data.dataHours]);
            
                    var tr = tableElement.insertRow(-1);
                    for (var h = 0; h < arrHead.length; h++) {
                        var th = document.createElement('th');              // TABLE HEADER.
                        th.innerHTML = arrHead[h];
                        tr.appendChild(th);
                    }
                    for (var c = 0; c <= arrValue.length - 1; c++) {
                        tr = tableElement.insertRow(-1);
                        
                        for (var j = 0; j < arrHead.length; j++) {
                            var td = document.createElement('td');          // TABLE DEFINITION.
                            td = tr.insertCell(-1);
                            //td.innerHTML = arrValue[c][j];                  
                            if(j==1){
                              console.log('cj-'+c);
                              var selectElement= document.createElement("select");
                                var optionElement = document.createElement("option");
                                optionElement.value = c;
                                optionElement.text = c;
                                selectElement.appendChild(optionElement);
                                td.appendChild(selectElement);
                            }
                            else{
                                td.innerHTML = arrValue[c][j];  // ADD VALUES TO EACH CELL.
                            }
                            
                        }
                    }
                    
                    
                    //console.log(params.data);
                    
                   return tableElement;
                  
                }},
                {headerName: "Effort", field: "totalHours",width: 150}
            ];
            
            
        
            $scope.gridOptions = {
                columnDefs: columnDefs,
                angularCompileRows:true,
                enableSorting:"true",
                enableFilter: "true",
                enableColResize: "true",
                onGridReady: function(){
                     $scope.gridOptions.api.sizeColumnsToFit();
                     loadJSONData();
                }
            };
            
            
            function loadJSONData(){
               var requirementData ='{!reqObjJson}';
               $scope.gridOptions.api.setRowData(JSON.parse(requirementData));
            }
        
        });
        
        
       </script>
    </body>
</html>
</apex:page>